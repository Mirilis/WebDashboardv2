
@{
    ViewData["Title"] = "Process Cards";

}
@{ 
    List<WebDashboardv2.Model.ProcessCard> ProcessCards = (List<WebDashboardv2.Model.ProcessCard>)ViewData["ProcessCards"];
    string ProcessCardClass = (string)ViewData["CardClass"];
    string CanEdit = ViewData["UserAccess"].ToString().ToLower(); 
}
<head>
    <link href="~/lib/jasny-bootstrap/dist/css/jasny-bootstrap.min.css" rel="stylesheet">
</head>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>@ProcessCardClass Process Cards</h5>
                                </div>
                                <div class="ibox-content">
                                    <input type="text" class="form-control input-sm m-b-xs" id="filter"
                                           placeholder="Search Process Cards">

                                    <table class="footable table table-stripped" data-filter-min="0" data-page-size="25" data-filter=#filter>
                                        <thead>
                                            <tr>
                                                <th>Product</th>
                                                <th>Department</th>
                                                <th>PDF</th>
                                               @if (bool.Parse(CanEdit))
                                               {
                                                <th data-hide="all"></th>
                                               }
                                            </tr>
                                        </thead>
                                        <tbody>
@foreach (var card in ProcessCards)
{
    
                                            <tr class="gradeX">
                                                <td>@card.ProductName</td>
                                                <td>@card.ProcessCardType</td>
                                                <td ><a ><i class="fa fa-file-pdf-o"/></a></td>
                                                <td>
                                                <div>
                                                    @if (bool.Parse(CanEdit))
                                                    { 
                                                    <div class="col-lg-9">
                                                        <div class="ibox float-e-margins">
                                                            <div class="ibox-title">
                                                                <h5>Data Values</h5>
                                                            </div>
                                                            <div class="ibox-content">

                                                                <table class="table table-striped" >
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Key</th>
                                                                            <th>Value</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        
                                                                            @foreach (var dp in card.DataPoints)
                                                                            {
                                                                                if (dp.Type == "image")
                                                                                {
                                                                                    <tr>
                                                                                        
                                                                                        <td>@dp.Key</td>
                                                                                        <td  width="400">
                                                                                            <form id="upload" method="post" enctype="multipart/form-data">
                                                                                                <div class="fileinput fileinput-new input-group" data-provides="fileinput">
                                                                                                    <div class="form-control" data-trigger="fileinput"><i class="glyphicon glyphicon-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
                                                                                                    <span class="input-group-addon btn btn-default btn-file"><span class="fileinput-new">Select file</span><span class="fileinput-exists">Change</span><input id="@card.ProductName @dp.Key IMG" type="file" name="..."></span>
                                                                                                    <a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Remove</a>
                                                                                                </div>
                                                                                                </form>
</td>
                                                                                        <td><input name="lockedBtn" id="@card.ProductName @dp.Key BTN" class="update-img-button" type="button" value="Update" data-style="expand-right" hidden="hidden" /></td>
                                                                                    </tr>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <tr>
                                                                                        <td>@dp.Key</td>
                                                                                        <td><input name="lockedTxt" id="@card.ProductName @dp.Key TXT" type="text" value="@dp.Value" readonly="readonly" /></td>
                                                                                        <td><input name="lockedBtn" id="@card.ProductName @dp.Key BTN" class="update-button" type="button" value="Update" data-style="expand-right" hidden="hidden" /></td>
                                                                                    </tr>

                                                                                }


                                                                            }
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                       
                                                    </div>

                                                    }</div> </td>
                                            </tr>

}
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="5">
                                                    <ul class="pagination pull-right"></ul>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                








    
@section Styles {
    <environment names="Development">
        <link rel="stylesheet" href="~/lib/footable/css/footable.core.css" />
    </environment>
    <environment names="Staging,Production">
        <link rel="stylesheet" href="~/lib/footable/css/footable.core.min.css" />
    </environment>
}

@section Scripts {
    <environment names="Development,Staging,Production">
        <script src="~/lib//jasny-bootstrap/js/fileinput.js"></script>
        <script src="~/lib/footable/dist/footable.all.min.js"></script>
    </environment>

    <script type="text/javascript">
        $(document).ready(function () {

            $('.footable').footable();
            $('.footable2').footable();


        });
    </script>


                <script type="text/javascript">
                    $(document).ready(function () {

                        // Add slimscroll to element
                        $('.scroll_content').slimscroll({
                            height: '25px'
                        })
                        $('input[name="lockedTxt"]').attr("readonly", !@CanEdit);
                        $('input[name="lockedBtn"]').attr("hidden", !@CanEdit);

                        $('.update-img-button').click(function () {
                            var a = ($(this).attr("id")).replace("BTN", "IMG");
                            alert("input[id='" + a + "']")
                            var newVal = JSON.stringify($("input[id='" + a + "']")[0].files[0]);
                        $.ajax({
                            type: "POST",
                                url: "@Url.Action("UploadImage")",
                                data: { value: newVal },
                                dataType: "json",
                                success: function () {
                                },
                                error: function () {
                                    alert("Update Failed")
                                }


                        })
                        });



                        $('.update-button').click(function () {


                            var a = ($(this).attr("id")).replace("BTN", "TXT");
                            var newVal = a.replace("TXT", $("input[id='" + a + "']").val());
                            $.ajax({
                                type: "POST",
                                url: "@Url.Action("Update")",
                                data: { value: newVal },
                                dataType: "json",
                                success: function () {
                                },
                                error: function () {
                                    alert("Update Failed")
                                }

                            })



                        })
                    });


                </script>
            }


